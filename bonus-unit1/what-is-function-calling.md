# 함수 호출이란 무엇인가요?

함수 호출은 **LLM이 환경에 대해 조치를 취하는 방법**입니다. 이는 [GPT-4에서 처음 소개되었으며](https://openai.com/index/function-calling-and-other-api-updates/) 나중에 다른 모델에서도 재현되었습니다.

에이전트의 도구와 마찬가지로 함수 호출은 모델에 **환경에 대해 조치를 취할 수 있는** 기능을 제공합니다. 그러나 함수 호출 기능은 **모델에 의해 학습**되며 **다른 에이전트 기술보다 프롬프트에 덜 의존**합니다.

1단원 동안 에이전트는 **도구를 사용하는 방법을 배우지 않았습니다**. 우리는 단지 목록을 제공했으며 모델이 **이러한 도구를 사용하여 계획을 정의하는 데 일반화할 수 있다는 사실**에 의존했습니다.

반면 여기서는 **함수 호출을 통해 에이전트가 도구를 사용하도록 미세 조정(훈련)됩니다**.

## 모델은 어떻게 조치를 취하는 것을 "학습"하나요?

1단원에서는 에이전트의 일반적인 워크플로를 살펴보았습니다. 사용자가 에이전트에게 몇 가지 도구를 제공하고 쿼리로 프롬프트를 표시하면 모델은 다음을 순환합니다.

1. *생각*: 목표를 달성하기 위해 어떤 조치를 취해야 합니까?
2. *행동*: 올바른 매개변수로 작업을 형식화하고 생성을 중지합니다.
3. *관찰*: 실행 결과를 다시 가져옵니다.

API를 통해 모델과 "일반적인" 대화를 나누는 경우 대화는 다음과 같이 사용자와 도우미 메시지 사이를 번갈아 가며 진행됩니다.

```python
conversation = [
    {"role": "user", "content": "주문에 도움이 필요합니다."},
    {"role": "assistant", "content": "기꺼이 도와드리겠습니다. 주문 번호를 알려주시겠어요?"},
    {"role": "user", "content": "ORDER-123입니다."},
]
```

함수 호출은 **대화에 새로운 역할을 부여합니다**!

1. **작업**에 대한 새로운 역할 하나
2. **관찰**에 대한 새로운 역할 하나

[Mistral API](https://docs.mistral.ai/capabilities/function_calling/)를 예로 들면 다음과 같습니다.

```python
conversation = [
    {
        "role": "user",
        "content": "거래 T1001의 상태는 어떻습니까?"
    },
    {
        "role": "assistant",
        "content": "",
        "function_call": {
            "name": "retrieve_payment_status",
            "arguments": "{"transaction_id": "T1001"}"
        }
    },
    {
        "role": "tool",
        "name": "retrieve_payment_status",
        "content": "{"status": "Paid"}"
    },
    {
        "role": "assistant",
        "content": "거래 T1001이 성공적으로 지불되었습니다."
    }
]
```

> ... 하지만 함수 호출에 대한 새로운 역할이 있다고 하셨잖아요?

**예와 아니요**, 이 경우 및 다른 많은 API에서 모델은 "어시스턴트" 메시지로 수행할 작업을 형식화합니다. 그러면 채팅 템플릿이 이를 함수 호출을 위한 **특수 토큰**으로 나타냅니다.

- `[AVAILABLE_TOOLS]` – 사용 가능한 도구 목록 시작
- `[/AVAILABLE_TOOLS]` – 사용 가능한 도구 목록 종료
- `[TOOL_CALLS]` – 도구 호출(즉, "작업" 수행)
- `[TOOL_RESULTS]` – 작업 결과 "관찰"
- `[/TOOL_RESULTS]` – 관찰 종료(즉, 모델이 다시 디코딩할 수 있음)

이 과정에서 함수 호출에 대해 다시 이야기하겠지만, 더 자세히 알아보고 싶다면 [이 훌륭한 설명서 섹션](https://docs.mistral.ai/capabilities/function_calling/)을 확인해 보세요.

---
이제 함수 호출이 무엇이며 어떻게 작동하는지 배웠으니, 아직 해당 기능이 없는 모델에 몇 가지 함수 호출 기능을 추가해 보겠습니다. [google/gemma-2-2b-it](https://huggingface.co/google/gemma-2-2b-it)에 몇 가지 새로운 특수 토큰을 추가하여 이를 수행합니다.

이를 수행하려면 **먼저 미세 조정 및 LoRA를 이해해야 합니다**. 