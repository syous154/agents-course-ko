# ë‚˜ë§Œì˜ í¬ì¼“ëª¬ ë°°í‹€ ì—ì´ì „íŠ¸ ë§Œë“¤ê¸°

ì´ì œ ê²Œì„ì—ì„œ ì—ì´ì „íŠ¸ AIì˜ ì ì¬ë ¥ê³¼ í•œê³„ë¥¼ íƒìƒ‰í–ˆìœ¼ë‹ˆ ì§ì ‘ ì‹¤ìŠµí•´ ë³¼ ì°¨ë¡€ì…ë‹ˆë‹¤. ì´ ì„¹ì…˜ì—ì„œëŠ” ê³¼ì • ì „ì²´ì—ì„œ ë°°ìš´ ëª¨ë“  ê²ƒì„ ì‚¬ìš©í•˜ì—¬ **í¬ì¼“ëª¬ ìŠ¤íƒ€ì¼ í„´ì œ ì „íˆ¬ì—ì„œ ì‹¸ìš¸ ë‚˜ë§Œì˜ AI ì—ì´ì „íŠ¸ë¥¼ êµ¬ì¶•**í•©ë‹ˆë‹¤.

ì‹œìŠ¤í…œì„ ë„¤ ê°€ì§€ ì£¼ìš” êµ¬ì„± ìš”ì†Œë¡œ ë‚˜ëˆ„ê² ìŠµë‹ˆë‹¤.

- **Poke-env:** ê·œì¹™ ê¸°ë°˜ ë˜ëŠ” ê°•í™” í•™ìŠµ í¬ì¼“ëª¬ ë´‡ì„ í›ˆë ¨í•˜ë„ë¡ ì„¤ê³„ëœ Python ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

- **PokÃ©mon Showdown:** ì—ì´ì „íŠ¸ê°€ ì‹¸ìš¸ ì˜¨ë¼ì¸ ë°°í‹€ ì‹œë®¬ë ˆì´í„°ì…ë‹ˆë‹¤.

- **LLMAgentBase:** LLMì„ Poke-env ë°°í‹€ í™˜ê²½ê³¼ ì—°ê²°í•˜ê¸° ìœ„í•´ êµ¬ì¶•í•œ ì‚¬ìš©ì ì§€ì • Python í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

- **TemplateAgent:** ë‚˜ë§Œì˜ ê³ ìœ í•œ ë°°í‹€ ì—ì´ì „íŠ¸ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ì™„ì„±í•  ìŠ¤íƒ€í„° í…œí”Œë¦¿ì…ë‹ˆë‹¤.

ì´ëŸ¬í•œ ê° êµ¬ì„± ìš”ì†Œë¥¼ ìì„¸íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

## ğŸ§  Poke-env

![ë°°í‹€ gif](https://github.com/hsahovic/poke-env/raw/master/rl-gif.gif)

[Poke-env](https://github.com/hsahovic/poke-env)ëŠ” ì›ë˜ [Haris Sahovic](https://huggingface.co/hsahovic)ì´ ê°•í™” í•™ìŠµ ë´‡ì„ í›ˆë ¨í•˜ê¸° ìœ„í•´ êµ¬ì¶•í•œ Python ì¸í„°í˜ì´ìŠ¤ì´ì§€ë§Œ, ìš°ë¦¬ëŠ” ì´ë¥¼ ì—ì´ì „íŠ¸ AIì— ë§ê²Œ ìš©ë„ë¥¼ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
ì´ë¥¼ í†µí•´ ì—ì´ì „íŠ¸ëŠ” ê°„ë‹¨í•œ APIë¥¼ í†µí•´ PokÃ©mon Showdownê³¼ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì—ì´ì „íŠ¸ê°€ ìƒì†í•  `Player` í´ë˜ìŠ¤ë¥¼ ì œê³µí•˜ì—¬ ê·¸ë˜í”½ ì¸í„°í˜ì´ìŠ¤ì™€ í†µì‹ í•˜ëŠ” ë° í•„ìš”í•œ ëª¨ë“  ê²ƒì„ ë‹¤ë£¹ë‹ˆë‹¤.

**ì„¤ëª…ì„œ**: [poke-env.readthedocs.io](https://poke-env.readthedocs.io/en/stable/)
**ë¦¬í¬ì§€í† ë¦¬**: [github.com/hsahovic/poke-env](https://github.com/hsahovic/poke-env)

## âš”ï¸ PokÃ©mon Showdown

[PokÃ©mon Showdown](https://pokemonshowdown.com/)ì€ ì—ì´ì „íŠ¸ê°€ ë¼ì´ë¸Œ í¬ì¼“ëª¬ ë°°í‹€ì„ í”Œë ˆì´í•  [ì˜¤í”ˆ ì†ŒìŠ¤](https://github.com/smogon/Pokemon-Showdown) ë°°í‹€ ì‹œë®¬ë ˆì´í„°ì…ë‹ˆë‹¤.
ì‹¤ì‹œê°„ìœ¼ë¡œ ë°°í‹€ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ê³  í‘œì‹œí•˜ëŠ” ì „ì²´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ìš°ë¦¬ì˜ ì±Œë¦°ì§€ì—ì„œ ë´‡ì€ ì¸ê°„ í”Œë ˆì´ì–´ì²˜ëŸ¼ í–‰ë™í•˜ì—¬ í„´ë§ˆë‹¤ ê¸°ìˆ ì„ ì„ íƒí•©ë‹ˆë‹¤.

ëª¨ë“  ì°¸ê°€ìê°€ ë°°í‹€ì— ì‚¬ìš©í•  ì„œë²„ë¥¼ ë°°í¬í–ˆìŠµë‹ˆë‹¤. ëˆ„ê°€ ìµœê³ ì˜ AI ë°°í‹€ ì—ì´ì „íŠ¸ë¥¼ ë§Œë“œëŠ”ì§€ ë´…ì‹œë‹¤!

**ë¦¬í¬ì§€í† ë¦¬**: [github.com/smogon/Pokemon-Showdown](https://github.com/smogon/Pokemon-Showdown)
**ì›¹ì‚¬ì´íŠ¸**: [pokemonshowdown.com](https://pokemonshowdown.com/)

## ğŸ”Œ LLMAgentBase

`LLMAgentBase`ëŠ” **Poke-env**ì˜ `Player` í´ë˜ìŠ¤ë¥¼ í™•ì¥í•˜ëŠ” Python í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
**LLM**ê³¼ **í¬ì¼“ëª¬ ë°°í‹€ ì‹œë®¬ë ˆì´í„°** ì‚¬ì´ì˜ ë‹¤ë¦¬ ì—­í• ì„ í•˜ì—¬ ì…/ì¶œë ¥ í˜•ì‹ ì§€ì • ë° ë°°í‹€ ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ì´ ê¸°ë³¸ ì—ì´ì „íŠ¸ëŠ” í™˜ê²½ê³¼ ìƒí˜¸ ì‘ìš©í•˜ê¸° ìœ„í•œ ë„êµ¬ ì„¸íŠ¸(`STANDARD_TOOL_SCHEMA`ì— ì •ì˜ë¨)ë¥¼ ì œê³µí•˜ë©° ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤.

- `choose_move`: ë°°í‹€ ì¤‘ ê³µê²©ì„ ì„ íƒí•˜ê¸° ìœ„í•´
- `choose_switch`: í¬ì¼“ëª¬ì„ êµì²´í•˜ê¸° ìœ„í•´

LLMì€ ì´ëŸ¬í•œ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²½ê¸° ì¤‘ì— ê²°ì •ì„ ë‚´ë ¤ì•¼ í•©ë‹ˆë‹¤.

### ğŸ§  í•µì‹¬ ë…¼ë¦¬

- `choose_move(battle: Battle)`: ë§¤ í„´ í˜¸ì¶œë˜ëŠ” ê¸°ë³¸ ë©”ì„œë“œì…ë‹ˆë‹¤. `Battle` ê°œì²´ë¥¼ ê°€ì ¸ì™€ LLMì˜ ì¶œë ¥ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì—… ë¬¸ìì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

### ğŸ”§ ì£¼ìš” ë‚´ë¶€ ë©”ì„œë“œ

- `_format_battle_state(battle)`: í˜„ì¬ ë°°í‹€ ìƒíƒœë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ì—¬ LLMìœ¼ë¡œ ë³´ë‚´ê¸°ì— ì í•©í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.

- `_find_move_by_name(battle, move_name)`: `choose_move`ë¥¼ í˜¸ì¶œí•˜ëŠ” LLM ì‘ë‹µì— ì‚¬ìš©ë˜ëŠ” ì´ë¦„ìœ¼ë¡œ ê¸°ìˆ ì„ ì°¾ìŠµë‹ˆë‹¤.

- `_find_pokemon_by_name(battle, pokemon_name)`: LLMì˜ êµì²´ ëª…ë ¹ì— ë”°ë¼ êµì²´í•  íŠ¹ì • í¬ì¼“ëª¬ì„ ì°¾ìŠµë‹ˆë‹¤.

- `_get_llm_decision(battle_state)`: ì´ ë©”ì„œë“œëŠ” ê¸°ë³¸ í´ë˜ìŠ¤ì—ì„œ ì¶”ìƒì ì…ë‹ˆë‹¤. LLMì„ ì¿¼ë¦¬í•˜ê³  ì‘ë‹µì„ êµ¬ë¬¸ ë¶„ì„í•˜ëŠ” ë°©ë²•ì„ ì •ì˜í•˜ëŠ” ìì‹ ë§Œì˜ ì—ì´ì „íŠ¸(ë‹¤ìŒ ì„¹ì…˜ ì°¸ì¡°)ì—ì„œ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.

ë‹¤ìŒì€ í•´ë‹¹ ì˜ì‚¬ ê²°ì •ì´ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ë³´ì—¬ì£¼ëŠ” ë°œì·Œë¬¸ì…ë‹ˆë‹¤.


```python
STANDARD_TOOL_SCHEMA = {
    "choose_move": {
        ...
    },
    "choose_switch": {
        ...
    },
}

class LLMAgentBase(Player):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.standard_tools = STANDARD_TOOL_SCHEMA
        self.battle_history = []

    def _format_battle_state(self, battle: Battle) -> str:
        active_pkmn = battle.active_pokemon
        active_pkmn_info = f"ë‹¹ì‹ ì˜ í™œì„± í¬ì¼“ëª¬: {active_pkmn.species} " \
                           f"(íƒ€ì…: {'/'.join(map(str, active_pkmn.types))}) " \
                           f"HP: {active_pkmn.current_hp_fraction * 100:.1f}% " \
                           f"ìƒíƒœ: {active_pkmn.status.name if active_pkmn.status else 'ì—†ìŒ'} " \
                           f"ë¶€ìŠ¤íŠ¸: {active_pkmn.boosts}"

        opponent_pkmn = battle.opponent_active_pokemon
        opp_info_str = "ì•Œ ìˆ˜ ì—†ìŒ"
        if opponent_pkmn:
            opp_info_str = f"{opponent_pkmn.species} " \
                           f"(íƒ€ì…: {'/'.join(map(str, opponent_pkmn.types))}) " \
                           f"HP: {opponent_pkmn.current_hp_fraction * 100:.1f}% " \
                           f"ìƒíƒœ: {opponent_pkmn.status.name if opponent_pkmn.status else 'ì—†ìŒ'} " \
                           f"ë¶€ìŠ¤íŠ¸: {opponent_pkmn.boosts}"
        opponent_pkmn_info = f"ìƒëŒ€ì˜ í™œì„± í¬ì¼“ëª¬: {opp_info_str}"

        available_moves_info = "ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ìˆ :\n"
        if battle.available_moves:
            available_moves_info += "\n".join(
                [f"- {move.id} (íƒ€ì…: {move.type}, BP: {move.base_power}, ì •í™•ë„: {move.accuracy}, PP: {move.current_pp}/{move.max_pp}, ì¹´í…Œê³ ë¦¬: {move.category.name})"
                 for move in battle.available_moves]
            )
        else:
             available_moves_info += "- ì—†ìŒ (êµì²´ ë˜ëŠ” ë°œë²„ë‘¥ì³ì•¼ í•¨)"

        available_switches_info = "ì‚¬ìš© ê°€ëŠ¥í•œ êµì²´:\n"
        if battle.available_switches:
              available_switches_info += "\n".join(
                  [f"- {pkmn.species} (HP: {pkmn.current_hp_fraction * 100:.1f}%, ìƒíƒœ: {pkmn.status.name if pkmn.status else 'ì—†ìŒ'})")"
                   for pkmn in battle.available_switches]
              )
        else:
            available_switches_info += "- ì—†ìŒ"

        state_str = f"{active_pkmn_info}\n"
                    f"{opponent_pkmn_info}\n\n"
                    f"{available_moves_info}\n\n"
                    f"{available_switches_info}\n\n"
                    f"ë‚ ì”¨: {battle.weather}\n"
                    f"ì§€í˜•: {battle.fields}\n"
                    f"ë‹¹ì‹ ì˜ í•„ë“œ ìƒíƒœ: {battle.side_conditions}\n"
                    f"ìƒëŒ€ì˜ í•„ë“œ ìƒíƒœ: {battle.opponent_side_conditions}"
        return state_str.strip()

    def _find_move_by_name(self, battle: Battle, move_name: str) -> Optional[Move]:
        normalized_name = normalize_name(move_name)
        # ì •í™•í•œ ID ì¼ì¹˜ ìš°ì„ 
        for move in battle.available_moves:
            if move.id == normalized_name:
                return move
        # ëŒ€ì²´: í‘œì‹œ ì´ë¦„ í™•ì¸ (ì‹ ë¢°ì„± ë‚®ìŒ)
        for move in battle.available_moves:
            if move.name.lower() == move_name.lower():
                print(f"ê²½ê³ : ID '{move.id}' ëŒ€ì‹  í‘œì‹œ ì´ë¦„ '{move.name}'ìœ¼ë¡œ ê¸°ìˆ  ì¼ì¹˜. ì…ë ¥ì€ '{move_name}'ì´ì—ˆìŠµë‹ˆë‹¤.")
                return move
        return None

    def _find_pokemon_by_name(self, battle: Battle, pokemon_name: str) -> Optional[Pokemon]:
        normalized_name = normalize_name(pokemon_name)
        for pkmn in battle.available_switches:
            # ë¹„êµë¥¼ ìœ„í•´ ì¢… ì´ë¦„ ì •ê·œí™”
            if normalize_name(pkmn.species) == normalized_name:
                return pkmn
        return None

    async def choose_move(self, battle: Battle) -> str:
        battle_state_str = self._format_battle_state(battle)
        decision_result = await self._get_llm_decision(battle_state_str)
        print(decision_result)
        decision = decision_result.get("decision")
        error_message = decision_result.get("error")
        action_taken = False
        fallback_reason = ""

        if decision:
            function_name = decision.get("name")
            args = decision.get("arguments", {})
            if function_name == "choose_move":
                move_name = args.get("move_name")
                if move_name:
                    chosen_move = self._find_move_by_name(battle, move_name)
                    if chosen_move and chosen_move in battle.available_moves:
                        action_taken = True
                        chat_msg = f"AI ê²°ì •: ê¸°ìˆ  '{chosen_move.id}' ì‚¬ìš©."
                        print(chat_msg)
                        return self.create_order(chosen_move)
                    else:
                        fallback_reason = f"LLMì´ ì‚¬ìš©í•  ìˆ˜ ì—†ê±°ë‚˜ ì˜ëª»ëœ ê¸°ìˆ  '{move_name}'ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤."
                else:
                     fallback_reason = "LLM 'choose_move'ê°€ 'move_name' ì—†ì´ í˜¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤."
            elif function_name == "choose_switch":
                pokemon_name = args.get("pokemon_name")
                if pokemon_name:
                    chosen_switch = self._find_pokemon_by_name(battle, pokemon_name)
                    if chosen_switch and chosen_switch in battle.available_switches:
                        action_taken = True
                        chat_msg = f"AI ê²°ì •: '{chosen_switch.species}'(ìœ¼)ë¡œ êµì²´."
                        print(chat_msg)
                        return self.create_order(chosen_switch)
                    else:
                        fallback_reason = f"LLMì´ ì‚¬ìš©í•  ìˆ˜ ì—†ê±°ë‚˜ ì˜ëª»ëœ êµì²´ '{pokemon_name}'ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤."
                else:
                    fallback_reason = "LLM 'choose_switch'ê°€ 'pokemon_name' ì—†ì´ í˜¸ì¶œë˜ì—ˆìŠµë‹ˆë‹¤."
            else:
                fallback_reason = f"LLMì´ ì•Œ ìˆ˜ ì—†ëŠ” í•¨ìˆ˜ '{function_name}'ì„ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤."

        if not action_taken:
            if not fallback_reason:
                 if error_message:
                     fallback_reason = f"API ì˜¤ë¥˜: {error_message}"
                 elif decision is None:
                      fallback_reason = "LLMì´ ìœ íš¨í•œ í•¨ìˆ˜ í˜¸ì¶œì„ ì œê³µí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
                 else:
                      fallback_reason = "LLM ê²°ì • ì²˜ë¦¬ ì¤‘ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜."

            print(f"ê²½ê³ : {fallback_reason} ì„ì˜ì˜ ì‘ì—… ì„ íƒ.")

            if battle.available_moves or battle.available_switches:
                 return self.choose_random_move(battle)
            else:
                 print("AI ëŒ€ì²´: ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ìˆ ì´ë‚˜ êµì²´ê°€ ì—†ìŠµë‹ˆë‹¤. ë°œë²„ë‘¥/ê¸°ë³¸ ì‚¬ìš©.")
                 return self.choose_default_move(battle)

    async def _get_llm_decision(self, battle_state: str) -> Dict[str, Any]:
        raise NotImplementedError("í•˜ìœ„ í´ë˜ìŠ¤ëŠ” _get_llm_decisionì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.")
```

**ì „ì²´ ì†ŒìŠ¤ ì½”ë“œ**: [agents.py](https://huggingface.co/spaces/Jofthomas/twitch_streaming/blob/main/agents.py)

## ğŸ§ª TemplateAgent

ì´ì œ ì¬ë¯¸ìˆëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤! LLMAgentBaseë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìì‹ ë§Œì˜ ì—ì´ì „íŠ¸ë¥¼ êµ¬í˜„í•˜ê³ , ìì‹ ë§Œì˜ ì „ëµìœ¼ë¡œ ìˆœìœ„í‘œì— ì˜¤ë¥¼ ì‹œê°„ì…ë‹ˆë‹¤.

ì´ í…œí”Œë¦¿ì—ì„œ ì‹œì‘í•˜ì—¬ ìì‹ ë§Œì˜ ë…¼ë¦¬ë¥¼ êµ¬ì¶•í•˜ê²Œ ë©ë‹ˆë‹¤. ë˜í•œ **OpenAI**, **Mistral** ë° **Gemini** ëª¨ë¸ì„ ì‚¬ìš©í•˜ëŠ” ì„¸ ê°€ì§€ [ì™„ì „í•œ ì˜ˆì œ](https://huggingface.co/spaces/Jofthomas/twitch_streaming/blob/main/agents.py)ë¥¼ ì œê³µí•˜ì—¬ ì•ˆë‚´í•©ë‹ˆë‹¤.

ë‹¤ìŒì€ í…œí”Œë¦¿ì˜ ë‹¨ìˆœí™”ëœ ë²„ì „ì…ë‹ˆë‹¤.

```python
class TemplateAgent(LLMAgentBase):
    """ê²°ì •ì„ ìœ„í•´ Template AI APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤."""
    def __init__(self, api_key: str = None, model: str = "model-name", *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.model = model
        self.template_client = TemplateModelProvider(api_key=...)
        self.template_tools = list(self.standard_tools.values())

    async def _get_llm_decision(self, battle_state: str) -> Dict[str, Any]:
        """ìƒíƒœë¥¼ LLMìœ¼ë¡œ ë³´ë‚´ê³  í•¨ìˆ˜ í˜¸ì¶œ ê²°ì •ì„ ë‹¤ì‹œ ë°›ìŠµë‹ˆë‹¤."""
        system_prompt = (
            "ë‹¹ì‹ ì€..."
        )
        user_prompt = f"..."

        try:
            response = await self.template_client.chat.completions.create(
                model=self.model,
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": user_prompt},
                ],
            )
            message = response.choices[0].message
            
            return {"decision": {"name": function_name, "arguments": arguments}}

        except Exception as e:
            print(f"í˜¸ì¶œ ì¤‘ ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜: {e}")
            return {"error": f"ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜: {e}"}
```

ì´ ì½”ë“œëŠ” ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë©°, ì‚¬ìš©ì ì§€ì • ë…¼ë¦¬ë¥¼ ìœ„í•œ ì²­ì‚¬ì§„ì…ë‹ˆë‹¤.

ëª¨ë“  ì¡°ê°ì´ ì¤€ë¹„ë˜ì—ˆìœ¼ë¯€ë¡œ ì´ì œ ê²½ìŸë ¥ ìˆëŠ” ì—ì´ì „íŠ¸ë¥¼ êµ¬ì¶•í•  ì°¨ë¡€ì…ë‹ˆë‹¤. ë‹¤ìŒ ì„¹ì…˜ì—ì„œëŠ” ì—ì´ì „íŠ¸ë¥¼ ì„œë²„ì— ë°°í¬í•˜ê³  ì‹¤ì‹œê°„ìœ¼ë¡œ ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ë°°í‹€í•˜ëŠ” ë°©ë²•ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

ë°°í‹€ì„ ì‹œì‘í•©ì‹œë‹¤! ğŸ”¥
